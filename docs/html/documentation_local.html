<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Running OnDA on a Local Machine &#8212; OnDA 19.09.0.3 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/my-styles.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example monitor.toml for Pilatus Files from the Filesystem" href="example_files_monitor_toml.html" />
    <link rel="prev" title="Example pilatus.geom for the Pilatus Detector" href="example_pilatus_geom.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          OnDA</a>
        <span class="navbar-text navbar-version pull-left"><b>19.09.0.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="documentation_what_is_an_onda_monitor.html">What is an OnDA Monitor?</a></li>
                <li><a href="documentation_running_onda.html">Running OnDA</a></li>
                <li><a href="documentation_advanced_documentation.html">Advanced Documentation</a></li>
                <li><a href="https://github.com/ondateam/onda">Source Code</a></li>
            
            
              
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="running-onda-on-a-local-machine">
<h1>Running OnDA on a Local Machine<a class="headerlink" href="#running-onda-on-a-local-machine" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please notice that OnDA is currently supported only on the Linux operating system.</p>
</div>
<div class="section" id="installing-onda">
<h2>Installing OnDA<a class="headerlink" href="#installing-onda" title="Permalink to this headline">¶</a></h2>
<p>OnDA can easily be installed on a local machine from the <a class="reference external" href="https://pypi.org/">Python Package Index</a>. It is also available as a package for the <a class="reference external" href="https://anaconda.org/">Anaconda</a> Python distribution.</p>
<div class="section" id="installation-from-the-python-package-index">
<h3>Installation from the Python Package Index<a class="headerlink" href="#installation-from-the-python-package-index" title="Permalink to this headline">¶</a></h3>
<p>OnDA can be installed from the Python Package Index (PyPI) using the ‘pip’ command.
This is the preferred installation method. The only requirements are:</p>
<ul class="simple">
<li>An actively supported version of Python (2.7, 3.5, 3.6, or 3.7).</li>
<li>The ‘pip’ utility for the corresponding version of python.</li>
</ul>
<p><strong>Python 3:</strong></p>
<p>It is recommended to install OnDA in a clean Python virtual environment. The
environment can be created using  the
<a class="reference external" href="https://docs.python.org/3/library/venv.html">venv</a> module from the Python 3
Standard Library:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m venv onda_env
</pre></div>
</div>
<p>The environment can be activated by sourcing a file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> onda_env/bin/activate
</pre></div>
</div>
<p>Finally, OnDA can be installed using the ‘pip’ command.
In order to install only the monitoring part of OnDA (without the graphical
interfaces):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m pip install onda
</pre></div>
</div>
<p>To instead install OnDA together with the Qt5-based graphical interfaces:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m pip install onda<span class="o">[</span>GUI<span class="o">]</span>
</pre></div>
</div>
<p>When the <em>mpi</em> Parallelization Layer is used (It is currently used by default), the
<em>mpi4py</em> module also needs to be installed. This requires a version of the MPI
libraries and headers to be installed on the machine.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m pip install mpi4py
</pre></div>
</div>
<p><strong>Python 2:</strong></p>
<p>For Python 2, the process, is very similar, except that the <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">virtualenv</a> tool must be used to create the environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python2 -m virtualenv onda_env
</pre></div>
</div>
<p>The rest of the process is then identical:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> onda_env/bin/activate
</pre></div>
</div>
<p>Then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python2 -m pip install onda
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python2 -m pip install onda<span class="o">[</span>GUI<span class="o">]</span>
</pre></div>
</div>
<p>When the <em>mpi</em> Parallelization Layer is used, the <em>mpi4py</em> module must also be
installed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python2 -m pip install mpi4py
</pre></div>
</div>
</div>
<div class="section" id="installation-in-anaconda">
<h3>Installation in Anaconda<a class="headerlink" href="#installation-in-anaconda" title="Permalink to this headline">¶</a></h3>
<p><strong>Python 3:</strong></p>
<p>Packages for OnDA and its dependencies are available in the <em>ondateam</em> channel of
<a class="reference external" href="https://anaconda.org/ondateam">Anaconda Cloud</a>.</p>
<p>Some of OnDA’s dependencies are only available in the <a class="reference external" href="https://conda-forge.org">conda-forge</a> community repository. The repository needs to be activated
on the system before OnDA is installed. This can be achieved in two ways. The first is
to add the repository using the <em>conda config</em> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda config --append channels conda-forge
</pre></div>
</div>
<p>Alternatively, one can directly add the repository to the <em>condarc</em> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="nt">channels</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">defaults</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>After the activation of the <em>conda-forge</em> repository, it is possible to proceed with
the installation of OnDA.</p>
<p>It is recommended to install OnDA in a clean Anaconda Python environment, which can be
created using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n onda_env <span class="nv">python</span><span class="o">=</span><span class="m">3</span>
</pre></div>
</div>
<p>Or, for Python 2:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n onda_env <span class="nv">python</span><span class="o">=</span><span class="m">2</span>
</pre></div>
</div>
<p>The environment can then be activated using <em>conda activate</em> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate onda_env
</pre></div>
</div>
<p>Finally, OnDA can be installed using the <em>conda install</em> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install --channel conda-forge --channel ondateam onda
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-onda">
<h2>Running OnDA<a class="headerlink" href="#running-onda" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please notice that all the <em>monitor.toml</em> configuration files and all the geometry
files provided in this page are just examples. They might need to be modified to
fit specific experiments.</p>
</div>
<p>Although it is possible to run OnDA on a local machine, it should be noted that OnDA is
not designed or optimized for the limited resources of a laptop or a small desktop
machine. Furthermore, when running OnDA locally, it is often very hard or impossible
to connect to the facility frameworks to retrieve data. Therefore, the following
paragraphs contain instructions aimed at getting OnDA to process files written by the
Pilatus detector (relatively small in size), stored in a folder on the local machine.
This is a good choice for debugging or demonstration purposes.</p>
<p>This example will use data files from an experiment performed at the APS facility, part
of the Argonne National Laboratory in the USA. These files have been deposited in the
<a class="reference external" href="http://cxidb.org/id-82.html">Coherent X-ray Imaging Data Bank</a>, an online database
of data from Serial Crystallography experiments.</p>
<p>The following paragraphs assume that the file <em>data8.tar.gz</em> has been downloaded from
<a class="reference external" href="http://cxidb.org/data/82/raw-data/">here</a> and unpacked (Beware, the data, even
compressed, is 24Gb).</p>
<p>In order to run OnDA on a local machine, a <em>monitor.toml</em> configuration file should be
created (See <a class="reference internal" href="documentation_configuration_file.html"><span class="doc">here</span></a> for a discussion of the
format and content of the configuration file).</p>
<ul class="simple">
<li><strong>Example monitor.toml for the Ti-Yen Lan dataset from the CXIDB website</strong>:
<a class="reference internal" href="example_files_monitor_toml.html"><span class="doc">monitor.toml</span></a></li>
</ul>
<p>All the files mentioned in the configuration file (masks, bad_pixel_masks, etc.) must
be present and readable on the local machine.</p>
<ul class="simple">
<li><strong>Example pilatus.geom for the Pilatus detector</strong>: <a class="reference internal" href="example_pilatus_geom.html"><span class="doc">pilatus.geom</span></a></li>
</ul>
<p>A file must finally be generated with the list of files that onda will process, each
with its own full absolute or relative path, one file per line. This file can easily be
created using the Unix <em>find</em> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Substitute &lt;path&gt; with the path to the downloaded files</span>
find &lt;path&gt; -name <span class="s2">&quot;*cbf&quot;</span> &gt; files.lst
</pre></div>
</div>
<p>In this command line, <em>path</em> should be replaced with the absolute or relative path to
the directory where the data files have been unpacked. For example, assuming that the
files are in the <em>data8</em> subdirectory in the current folder, the first lines of the
<em>files.lst</em> file should read:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data8/lysozyme2_test_000437.cbf
data8/lysozyme2_test_005699.cbf
data8/lysozyme2_test_001000.cbf
data8/lysozyme2_test_006581.cbf
data8/lysozyme2_test_006410.cbf
...
</pre></div>
</div>
<p>From the folder where the <em>monitor.toml</em> and <em>files.lst</em> files are, the OnDA monitor
can be started using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Substitute &lt;num_nodes&gt; with the appropriate number of nodes</span>
mpirun -n &lt;num_nodes&gt; onda_monitor.py files.lst
</pre></div>
</div>
<p>In the command line, <em>num_nodes</em> should be replaced with the total number of OnDA nodes
that the monitor should use (all workers plus a master). For a local machine and for
testing purposes, a value of 3 (just 2 workers + 1 master) is advised.</p>
<p>As the monitor starts, it prints on the console a line that contains the following
string: “Broadcasting data at &lt;ip&gt;:&lt;port&gt;” (where &lt;ip&gt; is an IP address string of the
form XXX.XXX.XXX.XXX, and &lt;port&gt; is a number). These values are needed to start the
graphical interfaces of OnDA. The OnDA GUI for Crystallography can be started using
the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace &lt;geometry_file&gt;,&lt;ip&gt; and &lt;port&gt; with appropriate values</span>
onda_crystallography_gui.py &lt;geometry_file&gt; &lt;ip&gt; &lt;port&gt;
</pre></div>
</div>
<p>In this command line, <em>geometry_file</em> should be replaced with the name of the geometry
file to be used for the visualization, and <em>ip</em> and <em>port</em> with the information
provided by the starting monitor.</p>
<p>The OnDA Frame Viewer for Crystallography can instead be started using the following
similar command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace &lt;geometry_file&gt;,&lt;ip&gt; and &lt;port&gt; with appropriate values</span>
onda_crystallography_frame_viewer.py &lt;geometry_file&gt; &lt;ip&gt; &lt;port&gt;
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 
    2014-2019 Deutsches Elektronen-Synchrotron DESY, a research centre of
    the Helmholtz Association
.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>